@page "/contact"
@using MudBlazor
@using MyPortfolio.Anna.Shared.Models
@inject HttpClient Http
@inject ISnackbar Snackbar

<div class="orbit-section aos-fade-up">
    <h2 class="orbit-section-title">Get In Touch</h2>
    <p class="orbit-section-subtitle">
        Whether it's a project, collaboration, or a technical discussion —
        feel free to reach out.
    </p>

    <div class="orbit-contact-wrapper">

        <!-- LEFT SIDE INFO -->
        <div class="orbit-contact-info">
            <div class="contact-icon-box">
                <i class="fa-solid fa-envelope"></i>
            </div>

            <h3>Email</h3>
            <p class="orbit-contact-email">
                <a href="mailto:rhnaafkh.private@gmail.com">
                    rhnaafkh.private@gmail.com
                </a>
            </p>

            <h3>Social Profiles</h3>
            <div class="orbit-contact-socials">
                <a href="https://github.com/rhnaakfh/MyPortfolio-Anna"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="social-link">
                    <i class="fa-brands fa-github"></i>
                    <span>GitHub</span>
                </a>

                <a href="https://www.linkedin.com/in/raihana-afikah-binti-nik-mohd-yusoff-08216336b/"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="social-link">
                    <i class="fa-brands fa-linkedin"></i>
                    <span>LinkedIn</span>
                </a>
            </div>
        </div>

        <!-- RIGHT SIDE FORM -->
        <div class="orbit-contact-form">
            <h3>Send Me a Message</h3>

            <EditForm Model="@ContactForm" OnValidSubmit="HandleSubmit">
                <DataAnnotationsValidator />
                <ValidationSummary />

                <input class="orbit-input"
                       placeholder="Your Name"
                       @bind="ContactForm.Name" />

                <input class="orbit-input"
                       type="email"
                       placeholder="Your Email"
                       @bind="ContactForm.Email" />

                <textarea class="orbit-input"
                          rows="5"
                          placeholder="Your Message"
                          @bind="ContactForm.Message"></textarea>

                <MudButton ButtonType="ButtonType.Submit"
                           Color="Color.Primary"
                           Variant="Variant.Filled"
                           Disabled="@IsSending"
                           Class="orbit-submit-btn">

                    @if (IsSending)
                    {
                        <MudProgressCircular Size="Size.Small"
                                             Indeterminate="true"
                                             Color="Color.Inherit"
                                             Class="me-2" />
                        <span>Sending...</span>
                    }
                    else
                    {
                        <span>Send Message</span>
                    }

                </MudButton>

            </EditForm>


            @if (!string.IsNullOrWhiteSpace(StatusMessage))
            {
                <p class="form-status">@StatusMessage</p>
            }
        </div>

    </div>
</div>

@code {
    private ContactMessage ContactForm = new();
    private bool IsSending;
    private string? StatusMessage;

    private async Task HandleSubmit()
    {
        IsSending = true;

        try
        {
            await Http.PostAsJsonAsync("api/contact", ContactForm);

            Snackbar.Add(
                "Message sent successfully!",
                Severity.Success
            );

            ContactForm = new(); // reset
        }
        catch
        {
            Snackbar.Add(
                "Failed to send message. Please try again later.",
                Severity.Error
            );
        }
        finally
        {
            IsSending = false;
        }
    }

}
